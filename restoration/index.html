<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10000 Cents</title>
  </head>
  <body>
    <svg id="bill"></svg>
    <script>
     
      var individualImageWidth = 8;
      var individualImageHeight = 3.4;
      var billHeight =individualImageHeight * 100; 
      var billWidth = individualImageWidth * 100;
      var popupHeight = 100;
      var popupWidth = 200;

      function setupBillSize(){
       
        var bill = document.getElementById('bill')
        bill.style.width = `${billWidth}px`
        bill.style.height = `${billHeight}px`
        
        y = 0;
       
        for (var i = 1; i < 100; i++){
            x = 0; 
          
            for (var j = 1; j < 100; j++){
                var svgns = "http://www.w3.org/2000/svg";
                var image = document.createElementNS(svgns, 'image');
                image.id = `${j}.${i}`
                image.setAttributeNS(null, 'x', x);
                image.setAttributeNS(null, 'y', y);
                image.setAttributeNS(null, 'height', individualImageHeight);
                image.setAttributeNS(null, 'width', individualImageWidth);
                image.setAttributeNS(null, 'href', `data/images/${j}.${i}.jpg`);
                document.getElementById('bill').appendChild(image);
                x += individualImageWidth
            }
            y += individualImageHeight
        }
      }

      function getPopUpOrientation(clickedImage){
        clickedImageXPos = clickedImage.getAttribute('x')
        clickedImageYPos = clickedImage.getAttribute('y')

        var midXPoint = billWidth/2
        var midYPoint = billHeight/2
        var position;

        if (clickedImageXPos > midXPoint && clickedImageYPos < midYPoint){
          position = 'topRight'
        }
        else if (clickedImageXPos > midXPoint && clickedImageYPos > midYPoint){
          position = 'bottomRight'
        }
        else if (clickedImageXPos < midXPoint && clickedImageYPos < midYPoint){
          position = 'topLeft'
        }
        else if (clickedImageXPos < midXPoint && clickedImageYPos > midYPoint){
          position = 'bottomLeft'
        }
        return position
      }

      function calculateCenterOfBox(id){
        var ids = id.split(".")
        var idX = ids[0]
        var idY = ids[1]

        centerX = idX * individualImageWidth
        centerY = idY * individualImageHeight

        return {'x': centerX, 'y': centerY}
      }

      function adjustXYPos(centerPos, position){
        var adjustedX;
        var adjustedY;
        if (position == 'topLeft'){
          adjustedX = centerPos.x + (individualImageWidth/2)
          adjustedY = centerPos.y - (individualImageHeight/2)
        }
        else if (position == 'bottomLeft'){
          adjustedX = centerPos.x + (individualImageWidth/2) 
          adjustedY = centerPos.y + (individualImageHeight/2) - popupHeight
        }
        else if (position == 'topRight'){
          adjustedX = centerPos.x - (individualImageWidth/2) - popupWidth
          adjustedY = centerPos.y - (individualImageHeight/2)
        }
        else if (position == 'bottomRight'){
          adjustedX = centerPos.x - (individualImageWidth/2) - popupWidth
          adjustedY = centerPos.y + (individualImageHeight/2) - popupHeight
        }
        return {'x': adjustedX, 'y': adjustedY}
      }

      function createPopUpBox(clickedImage){
       
        position = getPopUpOrientation(clickedImage)
        centerPos = calculateCenterOfBox(clickedImage.id)
        adjustedPostion = adjustXYPos(centerPos, position)

        var alreadyExists = document.getElementById('popup');
     
        if (alreadyExists){
          var parent = alreadyExists.parentNode
          parent.removeChild(alreadyExists)
        }

    
        var svgns = "http://www.w3.org/2000/svg";
        var popup = document.createElementNS(svgns, 'rect');
        popup.id = 'popup'
        popup.setAttributeNS(null, 'x', adjustedPostion.x);
        popup.setAttributeNS(null, 'y', adjustedPostion.y);
        popup.setAttributeNS(null, 'height', popupHeight);
        popup.setAttributeNS(null, 'width', popupWidth);

        document.getElementById('bill').appendChild(popup);
      

      }

      setupBillSize()

      document.getElementById('bill').addEventListener('click', function (event) {
        
        console.log(event.srcElement)
        createPopUpBox(event.srcElement)

      }, false);

    </script>
	  <script src="index.js"></script>
  </body>
</html>